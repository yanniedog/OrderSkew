<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NAB Homeloan Calculator | Public Edition</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="glow glow-a"></div>
    <div class="glow glow-b"></div>

    <main class="app-shell">
        <header class="hero">
            <p class="eyebrow">Public Web Edition</p>
            <h1>NAB Homeloan Calculator</h1>
            <p>
                Browser-only version adapted from your <code>NAB-transaction-history</code> project.
                Designed for general public hosting with no backend required.
            </p>
            <div class="hero-links">
                <a href="../index.html">Other tools</a>
                <a href="../../index.html">OrderSkew home</a>
            </div>
        </header>

        <section class="panel" aria-labelledby="upload-title">
            <h2 id="upload-title">Transaction history upload</h2>
            <p class="helper-text helper-text-top">
                Same workflow as the NAB transaction-history app: choose CSV, start analysis, then optionally submit ground truth.
                Processing happens locally in your browser only.
            </p>
            <div class="upload-section">
                <input type="file" id="pocketsmithFile" accept=".csv" class="file-input-hidden">
                <button id="uploadBtn" type="button">Choose Pocketsmith CSV</button>
                <button id="analyzeBtn" type="button" disabled>Start Analysis</button>
                <div id="selectedFileName" class="selected-file">No file selected</div>
                <div id="uploadStatus" class="status-box"></div>
            </div>
        </section>

        <section id="groundTruthSection" class="panel hidden" aria-labelledby="ground-truth-title">
            <h2 id="ground-truth-title">Ground truth data (optional)</h2>
            <p class="helper-text helper-text-top">
                Optional details from NAB app/site to tune interpretation. Skip if you only want direct file analysis.
            </p>
            <form id="groundTruthForm" class="form-grid" novalidate>
                <label>
                    <span>Current interest rate (% p.a.)</span>
                    <input type="number" id="currentInterestRate" step="0.01" min="0" max="100">
                </label>
                <label>
                    <span>As of date</span>
                    <input type="date" id="asOfDate">
                </label>
                <label>
                    <span>Scheduled monthly repayment (AUD)</span>
                    <input type="number" id="scheduledMonthlyRepayment" step="0.01" min="0">
                </label>
                <div class="action-row">
                    <button id="skipGroundTruthBtn" class="secondary" type="button">Skip Ground Truth</button>
                    <button id="submitWithGroundTruthBtn" type="button">Submit with Ground Truth</button>
                </div>
            </form>
        </section>

        <section id="analysisSummary" class="panel hidden" aria-labelledby="analysis-title">
            <h2 id="analysis-title">Transaction analysis summary</h2>
            <div class="result-grid">
                <article class="metric-card">
                    <h3>Effective monthly rate</h3>
                    <p id="analyzedEffectiveRate">-</p>
                </article>
                <article class="metric-card">
                    <h3>Projected payoff date</h3>
                    <p id="analyzedPayoffDate">-</p>
                </article>
                <article class="metric-card">
                    <h3>Transactions processed</h3>
                    <p id="analyzedTransactionCount">-</p>
                </article>
                <article class="metric-card">
                    <h3>Current annual rate</h3>
                    <p id="analyzedCurrentRate">-</p>
                </article>
                <article class="metric-card">
                    <h3>Margin above cash rate</h3>
                    <p id="analyzedCurrentMargin">-</p>
                </article>
                <article class="metric-card">
                    <h3>Rate change from initial</h3>
                    <p id="analyzedRateChange">-</p>
                </article>
                <article class="metric-card highlight">
                    <h3>Total interest saved</h3>
                    <p id="analyzedTotalSavings">-</p>
                </article>
                <article class="metric-card">
                    <h3>Average offset balance</h3>
                    <p id="analyzedAvgOffset">-</p>
                </article>
                <article class="metric-card">
                    <h3>Projected annual savings</h3>
                    <p id="analyzedProjectedSavings">-</p>
                </article>
            </div>
            <p id="analyzedAccounts" class="helper-text"></p>
        </section>

        <section class="panel" aria-labelledby="inputs-title">
            <h2 id="inputs-title">Loan inputs</h2>
            <form id="loan-form" class="form-grid" novalidate>
                <label>
                    <span>Loan amount (AUD)</span>
                    <input id="loan-amount" type="number" min="1" step="1000" value="650000" required>
                </label>

                <label>
                    <span>Interest rate (% p.a.)</span>
                    <input id="interest-rate" type="number" min="0" max="100" step="0.01" value="6.19" required>
                </label>

                <label>
                    <span>Loan term (years)</span>
                    <input id="loan-term-years" type="number" min="1" max="50" step="1" value="30" required>
                </label>

                <label>
                    <span>Repayment frequency</span>
                    <select id="repayment-frequency">
                        <option value="monthly" selected>Monthly</option>
                        <option value="fortnightly">Fortnightly</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </label>

                <label>
                    <span>Offset balance (AUD)</span>
                    <input id="offset-balance" type="number" min="0" step="100" value="0">
                </label>

                <label>
                    <span>Extra repayment per period (AUD)</span>
                    <input id="extra-repayment" type="number" min="0" step="10" value="0">
                </label>

                <label>
                    <span>Start date</span>
                    <input id="start-date" type="date" required>
                </label>

                <div class="action-row">
                    <button id="calculate-btn" type="submit">Calculate</button>
                    <button id="reset-btn" type="button" class="secondary">Reset</button>
                </div>
            </form>
            <p class="helper-text">
                Assumption: rate is fixed and interest is approximated per repayment period.
            </p>
        </section>

        <section class="panel" aria-labelledby="results-title">
            <h2 id="results-title">Results</h2>
            <div id="error-box" class="error-box hidden" role="alert"></div>
            <div class="result-grid">
                <article class="metric-card">
                    <h3>Minimum repayment</h3>
                    <p id="minimum-repayment">-</p>
                </article>
                <article class="metric-card">
                    <h3>Planned repayment</h3>
                    <p id="planned-repayment">-</p>
                </article>
                <article class="metric-card">
                    <h3>Projected payoff date</h3>
                    <p id="payoff-date">-</p>
                </article>
                <article class="metric-card">
                    <h3>Interest (no offset/extra)</h3>
                    <p id="baseline-interest">-</p>
                </article>
                <article class="metric-card">
                    <h3>Interest (with plan)</h3>
                    <p id="optimized-interest">-</p>
                </article>
                <article class="metric-card highlight">
                    <h3>Estimated interest saved</h3>
                    <p id="interest-saved">-</p>
                </article>
                <article class="metric-card">
                    <h3>Loan term reduction</h3>
                    <p id="term-reduction">-</p>
                </article>
                <article class="metric-card">
                    <h3>Total paid (with plan)</h3>
                    <p id="total-paid">-</p>
                </article>
            </div>
        </section>

        <section class="panel" aria-labelledby="chart-title">
            <h2 id="chart-title">Balance projection</h2>
            <canvas id="balance-chart" width="900" height="320" aria-label="Loan balance chart"></canvas>
            <p class="helper-text">
                Blue line: baseline loan path. Green line: your offset + extra repayment plan.
            </p>
        </section>

        <section class="panel" aria-labelledby="table-title">
            <div class="panel-head">
                <h2 id="table-title">Repayment schedule (plan)</h2>
                <button id="download-csv-btn" type="button" class="secondary">Download CSV</button>
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Date</th>
                            <th>Payment</th>
                            <th>Interest</th>
                            <th>Principal</th>
                            <th>Ending balance</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body"></tbody>
                </table>
            </div>
            <p id="schedule-note" class="helper-text"></p>
        </section>
    </main>

    <script src="app.js"></script>
</body>
</html>
